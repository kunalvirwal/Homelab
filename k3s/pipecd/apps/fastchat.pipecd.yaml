apiVersion: pipecd.dev/v1beta1
kind: KubernetesApp
spec:
  name: fastchat
  eventWatcher:
    - matcher:
        name: fastchat-image-update
      handler:
        type: GIT_UPDATE
        config:
          replacements:
            - file: ../../apps/fastchat/deployment.yaml
              yamlField: $.spec.template.spec.containers[0].image
  input:
    manifests:
      - ../../apps/fastchat/deployment.yaml
      - ../../apps/fastchat/service.yaml
      - ../../apps/fastchat/ingress.yaml
    kubectlVersion: 1.32.5
  trigger:
    onOutOfSync:
      disabled: false
      minWindow: 0m
  encryption:
    encryptedSecrets: # These secrets are key encrypted and safe to push to github for running pipecd but still it is a better practice to keep the repo private
      SECRET_KEY: AgCYqurFSaUKjWhJqf6MevbbjMcG5uvfrbMzo3vdPWpD6IUsOcCag7+ZWiBwKhlk8l3gqCV83WigBgTBWi2wZToTboCza0NE+WLadjtYwutZywwlKJsB0WVPHohUIresAj3wpPCnPskl/b5XMF6a6DZoyCB5GD+PKu6RDNbem1l++19JybJzYubDp8+EJFCy8yY3m2yeN0bx6hVuVB1fRcL+OR8LVMlQiSCw2aaqzPtjL8xK4GyJfqjkToFrhTvBj5MsrvSpN2lR6vffK11VSDZf5yX5a+N7SuCpGpQZuLmjE0+6daIQpwXeLVYuZmeR7swkCGHI6Ky9HchhRSy/DoU/IR/9HULFUuZillIqvkjxOgZwutVkTy3WHwI9TBt+8vwQDlwYfKY9GCFYXnjEjI97p+qoRkGKLTWRiYy9+U7yQALHsLx8SvtntjGtuZ5kZc2wKhL4UICysARuJpkCMYT+ePgElW22GqEUpYQnVqryXD/M7iGfH3N3R1I/uuMKR2Kuxqx6QTC6i3sCTde4IZ/rvRwjdTsAzfjztVw4kKpcMMjGQcB7/Efa6Wwx1VktJ8zwefk/lesvSI93nlmsT45l4ZFkGGNrAuG2RoFKn+7cSdSqF5WWGoWjj7atxALGvQcIvBhTg10k1wzQPjlBQwMiy1YkjBj7xpIHCeZsfY1aUAPQhSkx3FfPF9l621zExGH44iPVr4lPyWM=
      MONGODB_URI: AgAMjTW2+8AHD71CpxDg/bNmQUE/mUsqI/BvOQ97liJs+oDU4Pqh5AJZBLR+dWkCB1B7uTTiDXGIV1hDBMQlVL5402KaD4GycFdlmcmokKgnqbkcgfURXIZlr0/sU9Z32C55++on3oP7J5FMt/p07l5PsQwPCgMtWUqMO1GeOe9ISVcA9cmLfxqhWtM0/OGwXN3wnfR4OL9s4W7MOvGF4KED041PvB/6VGRQfvnbzyuuptc4ugaV/OPFg5Femc9eetLlgZ05qwLWlm/L7oPrRn9+nHRxdaHtyF9olQf5LLBBP5I2p6hfMAjSyfULlwgtnVBzzbByDdDeK6PtRwXdlSU+4yp7lOujUVlpREoR98ZdzfUn9LXj8uFCy/jYhucaBJ3YJ8iO27/hPtodZ6n3ilJkyqueN5Ps2LOForKsDZC9jmC9yRIr9lnNMmsK8fAgnsC2AamBlwFe6L+mTdZ0pmqMKgBgl4aR/cQfBkET4a7ugVldQ0yIYC0Nv/FKZkdkTNqfzgXAdJU34Jt2eOIvi+MiRBMbeyq+x9BR6Bs+PDL46LS3EG9GYUWcgHl8ZDYVU26p/kXe3XSHuoOs68YDg+pEZo7Z+OomuT7AJt7op/KZZYZGIb8KPAXCFzyGWSYw2JIJfywQzObANqoqrdo2quq87pIuFbwSunOh7HLFDt84sGTns0ZSMburfW2Smg+1rYeCPMbHh2nWuE5X8kSu4zyozqfyvgxGy5jg4mfyM/l3O51x4Xo41FmclMabpBYDbypPyhfnvB82HJ98BUMGxPgoFkuuJ75Caluql/D7YQkU6M0luqUqGSNbwWbZ1B2NnGlH5x1/
    decryptionTargets:
      - ../../apps/fastchat/deployment.yaml

  description: |
    This app is a self made chat server that uses websockets under the hood.
